# {{ ansible_managed }}

lxc.network.type = veth
{% if item.mac_address is defined %}
lxc.network.hwaddr = {{ item.mac_address }}
{% endif %}
lxc.network.flags = up
lxc.network.link = br0
lxc.rootfs = /var/lib/lxc/{{ item.name }}/rootfs
{% if item.distribution == 'ubuntu' %}
lxc.mount = /var/lib/lxc/{{ item.name }}/fstab
lxc.pivotdir = lxc_putold

lxc.devttydir =
{% endif %}
lxc.tty = 1
lxc.pts = 1024

lxc.utsname = {{ item.name }}
lxc.arch = amd64
lxc.cap.drop = sys_module mac_admin mac_override sys_time

# When using LXC with apparmor, uncomment the next line to run unconfined:
#lxc.aa_profile = unconfined

{% if item.distribution == 'ubuntu' %}
# To support container nesting on an Ubuntu host, uncomment next two lines:
#lxc.aa_profile = lxc-container-default-with-nesting
#lxc.hook.mount = /usr/share/lxc/hooks/mountcgroups

{% endif %}
lxc.cgroup.devices.deny = a
{% if item.distribution == 'ubuntu' %}
# Allow any mknod (but not using the node)
lxc.cgroup.devices.allow = c *:* m
lxc.cgroup.devices.allow = b *:* m
{% endif %}
# /dev/null and zero
lxc.cgroup.devices.allow = c 1:3 rwm
lxc.cgroup.devices.allow = c 1:5 rwm
# consoles
lxc.cgroup.devices.allow = c 5:1 rwm
lxc.cgroup.devices.allow = c 5:0 rwm
{% if item.distribution == 'debian' %}
lxc.cgroup.devices.allow = c 4:0 rwm
lxc.cgroup.devices.allow = c 4:1 rwm
{% endif %}
# /dev/{,u}random
lxc.cgroup.devices.allow = c 1:9 rwm
lxc.cgroup.devices.allow = c 1:8 rwm
lxc.cgroup.devices.allow = c 136:* rwm
lxc.cgroup.devices.allow = c 5:2 rwm
# rtc
lxc.cgroup.devices.allow = c 254:0 rm
{% if item.distribution == 'ubuntu' %}
# fuse
lxc.cgroup.devices.allow = c 10:229 rwm
# tun
lxc.cgroup.devices.allow = c 10:200 rwm
# full
lxc.cgroup.devices.allow = c 1:7 rwm
# hpet
lxc.cgroup.devices.allow = c 10:228 rwm
# kvm
lxc.cgroup.devices.allow = c 10:232 rwm{% endif %}
{% if item.distribution == 'debian' %}
# mounts point
lxc.mount.entry = proc proc proc nodev,noexec,nosuid 0 0
lxc.mount.entry = sysfs sys sysfs defaults  0 0
{% endif %}
