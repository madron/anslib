- name: os specific variables
  include_vars: "{{ ansible_lsb.id|lower() }}_{{ ansible_lsb.codename }}.yml"
  tags: nginx


- include: packages_debian.yml
  when: ansible_os_family == 'Debian'
  tags: nginx


- name: disable default site config
  file: >
    path=/etc/nginx/sites-enabled/default
    state=absent
  notify: reload nginx
  tags: nginx


- name: disable fallback site on listed ports
  template: >
    src=default_port.conf.j2
    dest=/etc/nginx/sites-available/default_{{ item }}.conf
    mode=0644
    owner=root
    group=root
  with_items: nginx_ports
  notify: reload nginx
  tags: nginx


- name: disable fallback site on listed ports - symlink
  file: >
    src=/etc/nginx/sites-available/default_{{ item }}.conf
    dest=/etc/nginx/sites-enabled/default_{{ item }}.conf
    state=link
    force=yes
    owner=root
    group=root
  with_items: nginx_ports
  notify: reload nginx
  tags: nginx


- name: start server
  service: >
    name=nginx
    state=started
  tags: nginx
