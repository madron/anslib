- name: os specific variables
  include_vars: "{{ ansible_lsb.id|lower() }}_{{ ansible_lsb.codename }}.yml"
  tags:
    - sensu-api


- name: etc directories
  file:
    path: '{{ item }}'
    state: directory
    mode: 0755
    owner: root
    group: root
  with_items:
    - '{{ sensu_api_etc_base_dir }}/{{ sensu_prefix }}/ssl'
  tags:
    - sensu-api


- name: ssl sertificates
  template:
    src: '{{ item }}'
    dest: '{{ sensu_api_etc_base_dir }}/{{ sensu_prefix }}/ssl/'
    mode: 0644
    owner: root
    group: root
  with_items:
    - cert.pem
    - key.pem
  notify: 'restart {{ sensu_prefix }}-sensu-api'
  tags:
    - sensu-api


- name: sensu-api upstart
  template:
    src: sensu-api.conf
    dest: '/etc/init/{{ sensu_prefix }}-sensu-api.conf'
    mode: 0644
    owner: root
    group: root
  tags:
    - sensu-api


- name: sensu-api service
  service:
    name: '{{ sensu_prefix }}-sensu-api'
    state: started
  tags:
    - sensu-api
