- name: required package
  apt:
    name: '{{ item }}'
    state: latest
  with_items: sensu_plugin_packages
  tags:
    - sensu-plugin


- name: ruby-sensu-plugin package
  copy:
    src: ruby-sensu-plugin_1.1.0-1_all.deb
    dest: /var/lib/ansible/sensu/plugin/ruby-sensu-plugin_1.1.0-1_all.deb
    mode: 0644
    owner: root
    group: root
  register: package
  when: sensu_plugin
  tags:
    - sensu-plugin


- name: ruby-sensu-plugin install
  command: dpkg -i /var/lib/ansible/sensu/plugin/ruby-sensu-plugin_1.1.0-1_all.deb
  when: sensu_plugin and package.changed
  tags:
    - sensu-plugin


- name: ruby-sensu-plugin install
  command: dpkg -i /var/lib/ansible/sensu/plugin/ruby-sensu-plugin_1.1.0-1_all.deb
  args:
    creates: /usr/share/doc/ruby-sensu-plugin
  when: sensu_plugin
  tags:
    - sensu-plugin
