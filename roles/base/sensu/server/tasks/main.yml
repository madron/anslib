- name: os specific variables
  include_vars: "{{ ansible_lsb.id|lower() }}_{{ ansible_lsb.codename }}.yml"
  tags:
    - sensu-server


- name: etc directories
  file:
    path: '{{ item }}'
    state: directory
    mode: 0755
    owner: root
    group: root
  with_items:
    - '{{ sensu_prefix_dir }}/{{ sensu_prefix }}/ssl'
    - '{{ sensu_prefix_dir }}/{{ sensu_prefix }}/conf.d'
  tags:
    - sensu-server


- name: ssl sertificates
  template:
    src: '{{ item }}'
    dest: '{{ sensu_prefix_dir }}/{{ sensu_prefix }}/ssl/'
    mode: 0644
    owner: root
    group: root
  with_items:
    - cert.pem
    - key.pem
  notify: 'restart {{ sensu_prefix }}-server'
  tags:
    - sensu-server


- name: sensu-server upstart
  template:
    src: sensu-server.conf
    dest: '/etc/init/{{ sensu_prefix }}-server.conf'
    mode: 0644
    owner: root
    group: root
  notify: 'restart {{ sensu_prefix }}-server'
  tags:
    - sensu-server


- name: sensu-server service
  service:
    name: '{{ sensu_prefix }}-server'
    state: started
  tags:
    - sensu-server
