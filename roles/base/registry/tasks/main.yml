- name: os specific variables
  include_vars: "{{ ansible_lsb.id|lower() }}_{{ ansible_lsb.codename }}.yml"
  tags:
    - registry


- name: set variables
  set_fact:
    registry_nginx_container_name: '{{ registry_prefix }}-nginx'
  tags:
    - registry


- name: /etc/container directory
  file:
    path: '/etc/container/{{ registry_nginx_container_name }}'
    state: directory
    mode: 0755
    owner: root
    group: root
  tags:
    - registry


- name: upstart file
  template:
    src: container.conf
    dest: '/etc/init/{{ registry_prefix }}.conf'
    mode: 0644
    owner: root
    group: root
  notify: 'restart {{ registry_prefix }}'
  tags:
    - registry


- name: registry service
  service:
    name: '{{ registry_prefix }}'
    state: started
  tags:
    - registry
