version: '3.1'

services:
  server:
    image: dockercloud/haproxy:{{ version }}
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    networks:
{% for network in global_networks %}
      - {{ network }}
{% endfor %}
    ports:
      - "0.0.0.0:{{ http_port }}:80/tcp"
      - "0.0.0.0:{{ https_port }}:443/tcp"
    deploy:
      replicas: {{ replicas }}
      placement:
        constraints:
{% for constraint in haproxy_constraints %}
          - {{ constraint }}
{% endfor %}


networks:
{% for network in global_networks %}
  {{ network }}:
    external: true
{% endfor %}
