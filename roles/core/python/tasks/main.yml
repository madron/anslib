- name: set variables
  set_fact:
    install: true
  tags: python

- name: check for installed python2 (in opt/bin)
  raw: "[ -f /opt/bin/python2 ] && echo 'installed' || echo 'missing'"
  changed_when: false
  register: py2_check
  tags: python

- name: install false
  set_fact:
    install: false
  when: py2_check.stdout_lines[0] == "installed"
  tags: python

- name: check for downloaded ActivePython package
  raw: "[ -f {{ap_python2_package_file_name}} ] && echo 'present' || echo 'missing'"
  register: package_check
  when: install
  tags: python

- name: download ActivePython
  raw: wget {{ap_python2_package_download_url}}
  when: install
  tags: python

- name: check for unzipped ActivePython package folder
  raw: "[ -d {{ap_python2_package_name}} ] && echo 'present' || echo 'missing'"
  register: package_folder_check
  when: install
  tags: python

- name: unzip ActivePython
  raw: tar -xvf {{ap_python2_package_file_name}}
  when: install
  tags: python

- name: create the resulting directory for ActivePython
  raw: 'mkdir -p /opt/bin/active_python'
  when: install
  tags: python

- name: install ActivePython
  raw: 'cd {{ap_python2_package_name}} && ./install.sh -I /opt/bin/active_python'
  when: install
  tags: python

# Setup links
- name: link easy_install
  raw: ln -sf /opt/bin/active_python/bin/easy_install /opt/bin/easy_install
  when: install
  tags: python

- name: link pip
  raw: ln -sf /opt/bin/active_python/bin/pip /opt/bin/pip
  when: install
  tags: python

- name: link python
  raw: ln -sf /opt/bin/active_python/bin/python /opt/bin/python
  when: install
  tags: python

- name: link python2
  raw: ln -sf /opt/bin/active_python/bin/python /opt/bin/python2
  when: install
  tags: python

- name: link virtualenv
  raw: ln -sf /opt/bin/active_python/bin/virtualenv /opt/bin/virtualenv
  when: install
  tags: python
