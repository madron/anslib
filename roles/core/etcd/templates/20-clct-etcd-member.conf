[Service]
ExecStart=
ExecStart=/usr/lib/coreos/etcd-wrapper $ETCD_OPTS \
  --name="{{ inventory_hostname }}" \
  --listen-peer-urls="https://{{ ansible_host }}:2380" \
  --listen-client-urls="https://{{ ansible_host }}:2379,https://127.0.0.1:2379" \
  --advertise-client-urls="https://{{ ansible_host }}:2379" \
  --initial-advertise-peer-urls="https://{{ ansible_host }}:2380" \
  --initial-cluster="{% for host in groups['mtf-etcd-hosts'] %}{{ hostvars[host]['inventory_hostname'] }}=https://{{ hostvars[host]['ansible_host'] }}:2380{% if not loop.last%},{% endif %}{% endfor %}" \
  --initial-cluster-state="new" \
  --initial-cluster-token="mtf" \
  --auto-tls \
  --peer-auto-tls
