# docker build -t mtek/sensu-base   roles/docker/mtek/sensu/base/files/docker/
# docker build -t sensu_api         roles/docker/mtek/sensu/api/files/docker/
# docker build -t sensu_server      roles/docker/mtek/sensu/server/files/docker/

data:
  image: busybox
  volumes:
    - /data
  hostname: data

redis:
  image: redis:2.8
  command: redis-server --appendonly yes
  volumes_from:
    - data
  ports:
    - "6379:6379"
  hostname: redis

rabbitmq:
  image: mtek/rabbitmq:3.4.3
  ports:
    - "5671:5671"
    - "5672:5672"
    - "15672:15672"
  environment:
    vhosts: '["/sensu"]'
    users: '[{"name": "sensu", "password": "sensu", "permission": {"/sensu": {"configure": ".*", "write": ".*", "read": ".*"}}}]'
  hostname: rabbitmq

api:
  build: api/files/docker
  links:
    - rabbitmq
    - redis
  environment:
    ssl: false
    rabbitmq_password: sensu
  hostname: api

server:
  build: server/files/docker
  links:
    - rabbitmq
    - redis
    - api
  environment:
    ssl: false
    rabbitmq_password: sensu
  hostname: server

# uchiwa:
#   build: uchiwa
#   links:
#     - api
#   ports:
#     - "80:3000"
#   hostname: uchiwa
